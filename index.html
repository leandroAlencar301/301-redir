<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Redirecionando...</title>
  <script type="module">
    async function logAcessoERedireciona() {
      const dados = {
        tz: Intl.DateTimeFormat().resolvedOptions().timeZone,
        idioma: navigator.language,
        plataforma: navigator.platform,
        user_agent: navigator.userAgent,
        referrer: document.referrer || "direto"
      };

      try {
        const ipResp = await fetch("https://ipapi.co/json/");
        const json = await ipResp.json();
        dados.ip = json.ip;
        dados.cidade = json.city;
        dados.regiao = json.region;
        dados.pais = json.country_name;
      } catch (err) {
        console.warn("Falha ao obter IP/localização", err);
      }

      // Insere no banco de dados Neon via Netlify Function
      try {
        await fetch("/api/log-access", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(dados)
        });
      } catch (err) {
        console.warn("Falha ao registrar acesso", err);
      }

      // Redireciona
      const sites = [
        "https://www.instagram.com/lopzthegodless/",
        "https://www.instagram.com/_jobins_/",
        "https://www.instagram.com/thomazrds/"
      ];
      const rnd = Math.floor(Math.random() * sites.length);
      window.location.replace(sites[rnd]);
    }

    logAcessoERedireciona();
  </script>
</head>
<body>
  <p>Redirecionando...</p>
</body>
</html>
